# 用户交互设计

## 交互设计理念

### 核心原则
1. **AI优先**: AI是用户操作图谱的主要方式，自然语言交互为核心
2. **直接操作**: 用户直接在图谱上进行编辑，所见即所得  
3. **渐进披露**: 从概览到细节的层次化信息展示
4. **上下文感知**: 根据用户当前状态提供相关功能
5. **一致性体验**: 跨组件的统一交互模式

### 认知负荷管理
- **空间认知**: 利用位置记忆帮助用户定位信息
- **视觉层次**: 通过大小、颜色、形状区分重要性
- **操作预测**: 清晰的视觉反馈和状态指示

## 多模式显示交互

### 节点显示模式

#### 1. DOT 模式 (概览模式)
**适用场景**: 大规模图谱概览、关系发现
**交互特点**:
- **悬停**: 显示节点标题和基本信息
- **单击**: 选中节点，显示连接关系
- **双击**: 切换到 BOX 模式
- **右键**: 显示快捷菜单

**视觉设计**:
```css
.dot-node {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
}

.dot-node:hover {
  transform: scale(1.2);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
```

#### 2. BOX 模式 (信息模式)
**适用场景**: 中等规模图谱、信息浏览
**交互特点**:
- **标题编辑**: 双击标题进行原地编辑
- **内容预览**: 显示前几行内容
- **模式切换**: 工具栏按钮或快捷键
- **连接操作**: 从边界拖拽创建连接

**布局结构**:
```
┌─────────────────────┐
│ 🔸 节点标题          │
├─────────────────────┤
│ 内容预览...          │
├─────────────────────┤
│ 2个内容块 • 概念     │
└─────────────────────┘
```

#### 3. CARD 模式 (编辑模式)
**适用场景**: 详细编辑、内容创作
**交互特点**:
- **完整编辑**: 支持标题、内容块的完整编辑
- **拖拽排序**: 内容块可以拖拽重新排序
- **快捷操作**: Enter 添加块、Backspace 删除块
- **富文本编辑**: 集成 PlateJS 编辑器

## 图谱交互操作

### 1. 节点操作

#### 创建节点
**触发方式**:
- 空白区域双击
- 右键菜单 "添加节点"
- 快捷键 Ctrl+N

**交互流程**:
```
双击空白区域 → 创建新节点 → 自动进入标题编辑 → 保存后切换到内容编辑
```

#### 移动节点
**操作模式**: 拖拽移动
**视觉反馈**:
- 拖拽时节点半透明
- 显示对齐辅助线
- 连接线实时更新

**位置保存**: 基于中心点坐标的持久化

#### 连接节点
**操作方式**:
1. **从句柄拖拽**: 从节点边缘的连接点拖拽
2. **选择模式**: 选中两个节点后右键 "创建连接"
3. **快速连接**: 按住 Shift 点击两个节点

**连接过程**:
```
开始拖拽 → 显示目标高亮 → 释放完成连接 → 设置语义标签
```

### 2. 边操作

#### 创建边
**语义标签设置**:
- 默认标签: "相关"
- 快速选择: 常用标签列表
- 自定义输入: 支持任意文本

**连接规则**:
- 节点到节点: 普通边
- 节点到关系节点: 参与关系
- 关系节点到节点: 包含关系

#### 编辑边
**原地编辑**:
- 双击边标签进行编辑
- 浮动工具栏快速设置
- 右侧面板详细配置

**视觉样式**:
- 边粗细表示关系强度
- 颜色编码表示关系类型
- 虚线表示不确定关系

### 3. 关系节点操作

#### 创建关系节点
**触发方式**:
- 选择多个节点后右键 "创建关系"
- 专用工具栏按钮
- 快捷键 Ctrl+R

**参与者管理**:
- 拖拽节点到关系节点添加参与者
- 关系节点面板管理参与者列表
- 自动生成参与连线

#### 关系类型设置
**预设类型**:
- 因果关系: 原因 → 结果
- 争论结构: 观点 ↔ 证据
- 集合关系: 成员 → 集合
- 演化链: 版本1 → 版本2 → 版本3

## 内容编辑交互

### 1. 富文本编辑

#### PlateJS 集成
**编辑模式切换**:
- 单击进入编辑: 显示光标和编辑工具
- 点击外部退出: 自动保存并退出编辑
- ESC 键取消: 恢复到编辑前状态

**快捷键支持**:
```
Ctrl+B: 加粗
Ctrl+I: 斜体
Ctrl+U: 下划线
Ctrl+Z: 撤销
Ctrl+Y: 重做
Enter: 换行
Shift+Enter: 强制换行
```

#### 内容块管理
**块操作**:
- **添加**: Enter 键在当前位置后添加新块
- **删除**: Backspace 在空块时删除
- **排序**: 拖拽句柄进行重新排序
- **类型**: 右键菜单切换块类型

**块类型**:
- 文本块: 默认富文本编辑
- 代码块: 语法高亮和格式化
- 图片块: 上传和引用管理
- 表格块: 结构化数据编辑

### 2. 批量操作

#### 多选操作
**选择方式**:
- 框选: 拖拽选择区域
- Ctrl+点击: 多选节点
- Shift+点击: 区间选择

**批量功能**:
- 移动: 保持相对位置移动
- 删除: 确认对话框批量删除
- 样式: 统一设置颜色和大小
- 分组: 创建关系节点包含选中项

## 视图切换交互

### 1. 视图标签系统

#### 标签管理
**标签操作**:
- 点击切换: 激活对应视图
- 中键关闭: 关闭视图标签
- 右键菜单: 重命名、复制、关闭其他

**标签状态**:
- 活跃标签: 高亮显示
- 修改标签: 显示修改指示器
- 临时标签: 斜体显示

#### 视图创建
**快速创建**:
- 右键节点 "在新视图中打开"
- 选择多个实体 "创建过滤视图"
- 空白标签页 "+"创建空视图

### 2. 显示模式切换

#### 全局模式切换
**工具栏切换**:
- 概览模式: 所有节点显示为点
- 浏览模式: 所有节点显示为框  
- 编辑模式: 选中节点显示为卡片

#### 单独模式设置
**节点级控制**:
- 右键菜单快速切换
- 浮动工具栏模式按钮
- 键盘快捷键 1/2/3

## 响应式交互设计

### 1. 自适应布局

#### 屏幕尺寸适配
**桌面端** (>1200px):
- 三栏布局: 导航 + 主区域 + 详情面板
- 完整功能: 所有交互功能可用

**平板端** (768-1200px):
- 两栏布局: 主区域 + 可折叠侧栏
- 简化工具栏: 收缩次要功能

**移动端** (<768px):
- 单栏布局: 全屏主区域
- 抽屉导航: 滑动调出面板

## AI交互设计规范

### AI助手的用户体验设计

#### 设计目标
**核心价值主张**: 让用户用自然语言创建和操作知识图谱，实现"魔法瞬间"

#### 1. AI助手界面设计

##### 折叠状态设计
**位置**: 右下角浮动，不遮挡主要内容

**视觉设计**:
```css
.ai-assistant-collapsed {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 24px;
  padding: 12px 16px;
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
  cursor: pointer;
  transition: all 0.3s ease;
}

.ai-icon {
  font-size: 24px;
  animation: subtle-glow 2s ease-in-out infinite alternate;
}
```

**交互反馈**:
- 悬停: 轻微放大 + 阴影加深
- 呼吸动画: 吸引用户注意但不打扰
- 状态指示: 图标变化显示AI可用性

##### 展开状态设计
**尺寸**: 最大宽度 480px，高度自适应

**布局结构**:
```
┌─────────────────────────────┐
│  🤖 AI 图谱助手        ×   │ ← 标题栏
├─────────────────────────────┤
│                             │
│  [多行文本输入框]            │ ← 输入区域
│                             │
├─────────────────────────────┤
│ Ctrl+Enter 发送    [生成]   │ ← 操作栏
├─────────────────────────────┤
│ "创建一个关于..."           │ ← 示例指令
│ "帮我整理..."              │
└─────────────────────────────┘
```

#### 2. AI交互流程设计

##### 用户输入阶段
**支持的输入方式**:
- 自然语言描述: "创建一个关于机器学习的知识图谱"
- 结构化指令: "添加3个子节点到人工智能节点"
- 上下文延续: "再添加深度学习相关内容"

**输入体验优化**:
- 自动补全常见指令
- 输入历史记录
- 智能纠错提示
- 实时字符统计

##### AI处理阶段
**处理状态显示**:
```typescript
interface AIProcessingStates {
  ANALYZING: "分析你的指令...";
  GENERATING: "生成图谱结构..."; 
  OPTIMIZING: "优化节点布局...";
  FINALIZING: "完成最后处理...";
}
```

**视觉反馈设计**:
- 进度指示器: 显示处理阶段
- 动画效果: 旋转加载 + 阶段文字
- 预期时间: "预计需要5-10秒"
- 可中断性: 提供取消按钮

##### 结果展示阶段
**成功状态**:
- ✅ 图标 + 成功提示
- AI解释: "我为你创建了..."
- 操作统计: "新增3个节点，2个连接"
- 后续建议: "你可以继续..."

**错误处理**:
- ❌ 图标 + 错误说明
- 重试选项: "重新尝试" 按钮
- 问题诊断: "可能是因为..."
- 指令建议: "试试这样说..."

#### 3. 快捷键和辅助交互

##### 全局快捷键
```typescript
interface AIShortcuts {
  'Ctrl/Cmd + K': '打开AI助手';
  'Ctrl/Cmd + Enter': 'AI输入框中发送指令';
  'Esc': '关闭AI助手';
  'Ctrl/Cmd + Z': '撤销AI操作';
  'Ctrl/Cmd + Y': '重做AI操作';
}
```

##### 上下文菜单集成
**节点右键菜单**:
- "让AI扩展这个节点"
- "AI建议相关连接"
- "AI优化这个区域"

**空白区域右键**:
- "AI创建新内容"
- "AI分析整个图谱"
- "AI建议布局优化"

#### 4. AI反馈和学习机制

##### 用户反馈收集
**操作后反馈**:
- 满意度评分: 👍 👎
- 具体问题: "结果不够准确" / "缺少某个节点"
- 改进建议: 文本输入框

**隐式反馈收集**:
- 撤销频率: 高撤销率表示结果不满意
- 后续编辑: 用户修改AI生成内容的模式
- 重复指令: 相似指令的使用频率

##### AI能力展示
**能力边界说明**:
- 明确告知AI能做什么
- 提供典型示例指令
- 解释AI的局限性

**学习提示**:
- "AI正在学习你的偏好"
- "根据你的使用习惯调整"
- "这个指令方式效果更好"

#### 5. 多设备适配

##### 桌面端体验
- 完整功能: 所有AI功能可用
- 快捷键支持: 完整键盘交互
- 多窗口: 支持多个AI对话

##### 移动端适配
- 简化界面: 关键功能保留
- 触摸优化: 大按钮 + 手势支持
- 语音输入: 集成语音识别
- 全屏模式: AI助手可全屏使用

### AI操作的可访问性设计

#### 屏幕阅读器支持
- 语义化HTML: 正确使用ARIA标签
- 状态通知: 实时状态变化播报
- 键盘导航: 完整键盘可访问性

#### 认知辅助
- 清晰指令: 避免技术术语
- 视觉提示: 图标 + 文字双重提示
- 错误宽容: 理解模糊或不完整指令
- 触摸优化: 放大点击区域

### 2. 交互模式适配

#### 鼠标交互
- 精确点击: 小目标精确操作
- 悬停反馈: 丰富的悬停信息
- 右键菜单: 上下文功能菜单
- 滚轮缩放: 平滑的缩放体验

#### 触摸交互
- 手势支持: 双指缩放、滑动平移
- 长按菜单: 替代右键菜单
- 触摸反馈: 视觉和震动反馈
- 防误触: 增大点击区域和容错

## 可访问性设计

### 1. 键盘导航
**焦点管理**:
- Tab 键顺序: 逻辑的焦点流转
- 焦点指示: 清晰的焦点视觉反馈
- 键盘陷阱: 避免焦点无法逃脱的区域

**快捷键系统**:
```
全局快捷键:
Ctrl+Z/Y: 撤销/重做
Ctrl+S: 保存
Ctrl+F: 搜索
Ctrl+N: 新建节点

导航快捷键:
Arrow Keys: 焦点移动
Enter: 激活/编辑
Escape: 取消/退出
Space: 选择/确认
```

### 2. 屏幕阅读器支持
**语义化标记**:
- ARIA 标签: 组件角色和状态
- 层次结构: 清晰的标题层次
- 状态描述: 动态状态的文本描述

**替代文本**:
- 图标描述: 所有图标的替代文本
- 图形描述: 图谱结构的文本描述
- 操作提示: 交互元素的用途说明

### 3. 视觉辅助
**对比度**: 符合 WCAG 2.1 AA 标准
**字体大小**: 支持系统字体缩放
**颜色使用**: 不仅依赖颜色传达信息
**动画控制**: 尊重用户的动画偏好设置