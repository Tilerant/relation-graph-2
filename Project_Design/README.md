# Graph-cc 设计文档总览

本文档集详细描述了 Graph-cc 知识图谱系统的设计思路、架构决策和实现细节，确保开发团队对系统有统一而深入的理解。

## 文档结构

### 📋 01_Overview - 项目概览
- **[项目愿景](01_Overview/project_vision.md)**: 产品定位、目标用户、核心价值主张

### 🏗️ 02_Architecture - 系统架构  
- **[系统架构](02_Architecture/system_architecture.md)**: 整体架构设计、技术选型、性能策略

### 📊 03_DataModel - 数据模型
- **[实体定义](03_DataModel/entity_definitions.md)**: 核心数据结构、实体关系、约束规则
- **[标签系统设计](03_DataModel/label_system_design.md)**: 实体标签、语义标签、注册化管理、图算法集成

### 🧩 04_Components - 组件设计
- **[组件层次](04_Components/component_hierarchy.md)**: 组件架构、职责划分、通信模式

### 🎯 05_UserInteraction - 交互设计
- **[交互设计](05_UserInteraction/interaction_design.md)**: 用户体验、操作流程、可访问性

### ⚙️ 06_TechnicalSpecs - 技术规范
- **[实现细节](06_TechnicalSpecs/implementation_details.md)**: 核心算法、性能优化、错误处理

## 核心设计理念

### 🎯 AI增强的结构化知识
系统以"AI深度协作的结构化知识表示"为核心理念，支持节点、边、关系节点三种实体类型，AI自动建议关系并生成结构化内容。

### 🤖 AI驱动的智能协作
AI作为系统的核心协作伙伴：
- **智能关系建议**: AI自动分析内容语义，推荐节点间的关系连接
- **内容智能生成**: AI直接操作白板，生成节点、关系及其结构化内容
- **语义理解增强**: 基于自然语言的图谱查询和操作
- **插件化AI功能**: 所有AI能力通过插件市场提供，用户可按需安装

### 🔄 多视图灵活展示  
- **空间视图**: 白板、思维导图、时间线、流程图
- **线性视图**: 富文本、表格、看板、列表、大纲  
- **媒体视图**: PDF、图片、视频、音频、网页、3D模型

### 📱 插件市场生态
开放的插件市场支持个性化功能扩展：
- **AI功能插件**: 关系建议、内容生成、语义分析等核心AI功能
- **专业领域插件**: 支持不同行业的专业化需求
- **第三方集成**: 开放API体系，支持深度定制和集成
- **热插拔加载**: 支持运行时动态加载和卸载功能

## 关键技术决策

### 1. 🎯 中心点坐标系统
**决策**: 存储节点中心点坐标，渲染时计算左上角位置  
**原因**: 确保不同显示模式（点/框/卡片）的位置一致性

### 2. 📝 统一富文本编辑
**决策**: 全系统使用 TipTap 提供一致的编辑体验  
**原因**: 轻量级架构、优秀的扩展性、现代化的API设计、更好的AI工具兼容性

### 3. 🔄 命令模式架构
**决策**: 所有数据修改通过命令系统执行  
**原因**: 完整的撤销/重做支持、操作历史追踪、中间件扩展

### 4. 📦 组件化设计
**决策**: UnifiedNode 组件支持多种显示模式  
**原因**: 代码复用、状态一致性、性能优化

## 技术栈概览

```json
{
  "前端框架": {
    "React": "19.1.0",
    "TypeScript": "5.8.3", 
    "Vite": "7.0.4"
  },
  "状态管理": {
    "Zustand": "5.0.7",
    "命令模式": "自实现"
  },
  "图形交互": {
    "React Flow": "12.8.2",
    "React DND": "16.0.1"
  },
  "富文本编辑": {
    "TipTap": "^2.2.0"
  },
  "样式方案": {
    "原生CSS": "模块化CSS + CSS变量",
    "CSS架构": "BEM方法论 + 组件作用域样式"
  }
}
```

## 分层数据流架构

### 三层分离设计
```
装饰层（无语义）→ 视图层（表现）→ 知识层（语义）
    ↓              ↓            ↓
  Drawing        Style        Node/Edge
   贴纸表情       布局样式       语义关系
    ↓              ↓            ↓
  视觉装饰       多视图呈现     AI理解操作
```

### 白板元素映射规则

| 白板元素 | 知识层映射 | 视图层属性 | 装饰层处理 |
|---------|-----------|-----------|----------|
| 文本框 | Node | shape, color | - |
| 连线 | Edge | lineStyle | - |
| 自由绘制 | - | - | Drawing |
| 贴纸表情 | - | - | Sticker |

### 数据流向
```
用户操作 → 分层处理 → AI协作 → 状态更新 → 多视图渲染
    ↓         ↓        ↓         ↓         ↓
  白板交互   语义提升   智能建议   状态同步   视觉反馈
    ↓         ↓        ↓         ↓         ↓
  插件扩展   知识生成   关系优化   实时协作   用户确认
```

## 核心组件层次

```
App (应用根组件)
├── MainLayout (主布局)
│   ├── ViewTabs (视图切换)
│   ├── WhiteboardView (白板视图)
│   │   ├── UnifiedNode (统一节点)
│   │   │   ├── DotNode (点模式)
│   │   │   ├── BoxNode (框模式)  
│   │   │   └── CardNode (卡片模式)
│   │   │       └── DraggableBlock (内容块)
│   │   │           └── TipTapEditor (富文本)
│   │   ├── GraphEdge (图边)
│   │   └── FloatingToolbar (工具栏)
│   └── RightPanel (详情面板)
│       ├── NodeView (节点详情)
│       ├── EdgeView (边详情)
│       └── RelationView (关系详情)
```

## 开发指南

### 🚀 快速开始
1. 参考 [CLAUDE.md](../CLAUDE.md) 了解项目架构
2. 阅读 [项目愿景](01_Overview/project_vision.md) 理解产品目标
3. 查看 [系统架构](02_Architecture/system_architecture.md) 掌握技术方案

### 📚 深入学习
1. **数据模型**: 从 [实体定义](03_DataModel/entity_definitions.md) 开始理解数据结构
2. **标签系统**: 学习 [标签系统设计](03_DataModel/label_system_design.md) 掌握语义化标签体系
3. **组件开发**: 参考 [组件层次](04_Components/component_hierarchy.md) 了解组件职责
4. **交互设计**: 学习 [交互设计](05_UserInteraction/interaction_design.md) 优化用户体验
5. **技术实现**: 查阅 [实现细节](06_TechnicalSpecs/implementation_details.md) 解决技术问题

### 🔧 开发规范
- **类型安全**: 严格使用 TypeScript 类型定义
- **组件设计**: 遵循单一职责原则，优先组合而非继承
- **状态管理**: 所有数据修改必须通过命令系统
- **性能优化**: 使用 React.memo、useMemo、选择器模式
- **代码质量**: 遵循 ESLint 规则，保持代码一致性

### 🧪 测试策略
- **单元测试**: 核心工具函数和数据转换逻辑
- **组件测试**: 关键组件的交互和状态管理
- **集成测试**: 命令系统和状态管理的端到端测试
- **E2E测试**: 核心用户流程的自动化测试

## 版本历史

### v0.1.0 (当前)
- ✅ 基础架构搭建
- ✅ 核心数据模型定义
- ✅ 三种节点显示模式
- ✅ TipTap 富文本集成
- ✅ 命令系统和撤销/重做
- ✅ 中心点坐标系统
- ✅ React Flow 图形交互
- ✅ 基础插件系统架构

### 📋 后续规划
- **v0.2.0**: AI协作核心功能（关系建议、内容生成）
- **v0.3.0**: 插件市场和AI功能插件
- **v0.4.0**: 多视图格式支持和专业领域插件
- **v0.5.0**: 协作功能和实时AI协同
- **v1.0.0**: 完整AI增强的知识图谱系统

## 贡献指南

### 📖 阅读顺序
新团队成员建议按以下顺序阅读文档：
1. README.md (本文档) - 获得全局概览
2. 项目愿景 - 理解产品定位
3. 系统架构 - 掌握技术架构  
4. 实体定义 - 理解数据模型
5. 标签系统设计 - 掌握语义化标签体系
6. 组件层次 - 了解代码结构
7. 交互设计 - 学习用户体验
8. 实现细节 - 解决技术问题

### 🔄 文档更新
- 重大架构变更时必须更新相关设计文档
- 新功能开发前先更新设计文档征求反馈
- 定期review文档内容确保与代码实现一致

### 💬 问题讨论
遇到设计相关问题时，请参考相应文档章节，如仍有疑问可通过以下方式讨论：
- 技术架构问题 → 系统架构文档
- 数据结构问题 → 实体定义文档
- 标签系统问题 → 标签系统设计文档
- 组件设计问题 → 组件层次文档
- 用户体验问题 → 交互设计文档

---

📍 **文档最后更新**: 2024年8月  
👥 **维护团队**: Graph-cc 开发团队  
📧 **联系方式**: 项目issue或团队内部讨论