# Graph-cc 设计文档总览

本文档集详细描述了 Relation-Graph 知识图谱笔记系统的设计思路、架构决策和实现细节，确保开发团队对系统有统一而深入的理解。

## 文档结构

### 📋 01_Overview - 项目概览
- **[项目愿景](01_Overview/project_vision.md)**: 产品定位、目标用户、核心价值主张

### 🏗️ 02_Architecture - 系统架构  
- **[系统架构](02_Architecture/system_architecture.md)**: 整体架构设计、技术选型、性能策略

### 📊 03_DataModel - 数据模型
- **[实体定义](03_DataModel/entity_definitions.md)**: 核心数据结构、实体关系、约束规则
- **[标签系统设计](03_DataModel/label_system_design.md)**: 实体标签、语义标签、注册化管理、图算法集成

### 🧩 04_Components - 组件设计
- **[组件层次](04_Components/component_hierarchy.md)**: 组件架构、职责划分、通信模式

### 🎯 05_UserInteraction - 交互设计
- **[交互设计](05_UserInteraction/interaction_design.md)**: 用户体验、操作流程、可访问性

### ⚙️ 06_TechnicalSpecs - 技术规范
- **[实现细节](06_TechnicalSpecs/implementation_details.md)**: 核心算法、性能优化、错误处理

## 核心设计理念

### 🎯 AI原生的图谱操作 
系统以"AI直接操作白板"为核心理念，用户通过自然语言与AI协作，一句话即可创建完整的知识图谱结构。AI不仅提供建议，而是直接执行节点创建、连接建立、布局优化等操作，实现真正的"魔法瞬间"用户体验。

### 🤖 AI驱动的智能协作
AI作为系统的核心协作伙伴：
- **自然语言创建**: 用一句话"创建一个关于机器学习的知识图谱"生成完整结构  
- **AI直接操作白板**: AI执行节点创建、连接建立、布局优化，而不仅是建议
- **智能结构理解**: AI理解领域知识，自动生成合理的层次关系和语义连接
- **可撤销AI操作**: 基于命令模式的完整撤销重做支持，用户保持完全控制权
- **上下文感知操作**: AI基于当前图谱状态，智能扩展和优化知识结构

### 🔄 灵活工作台模式  
- **多白板工作台**: 用户可在工作台界面随意创建和管理多个白板
- **统一视图系统**: 侧边栏支持加载所有类型的视图（空间视图、线性视图、媒体视图）
- **富文本详情视图**: 详情面板作为独立视图类型，提供完整的富文本编辑功能

### 📱 插件市场生态
开放的插件市场支持个性化功能扩展：
- **AI功能插件**: 关系建议、内容生成、语义分析等核心AI功能
- **专业领域插件**: 支持不同行业的专业化需求
- **第三方集成**: 开放API体系，支持深度定制和集成
- **热插拔加载**: 支持运行时动态加载和卸载功能

## 关键技术决策

### 1. 🎯 中心点坐标系统
**决策**: 存储节点中心点坐标，渲染时计算左上角位置  
**原因**: 确保不同显示模式（点/框/卡片）的位置一致性

### 2. 📝 统一富文本编辑
**决策**: 全系统使用 TipTap 提供一致的编辑体验  
**原因**: 轻量级架构、优秀的扩展性、现代化的API设计、更好的AI工具兼容性

### 3. 🔄 命令模式架构
**决策**: 所有数据修改通过命令系统执行  
**原因**: 完整的撤销/重做支持、操作历史追踪、中间件扩展

### 4. 🏢 灵活工作台架构
**决策**: 采用工作台模式，用户可自由创建多个白板，侧边栏统一管理所有视图类型  
**原因**: 提升用户工作效率、支持复杂项目管理、统一视图体验

### 5. 📝 富文本详情视图
**决策**: 详情面板设计为独立的富文本编辑器视图类型  
**原因**: 提供专业的文档编辑体验、与其他视图类型保持一致性、支持深度内容创作

### 6. 📦 统一视图系统
**决策**: 所有视图类型（白板、富文本、列表、媒体等）统一在侧边栏管理  
**原因**: 简化用户操作、提供一致的交互体验、便于扩展新视图类型

## 技术栈概览

```json
{
  "应用平台": {
    "Electron": "^28.0.0",
    "平台支持": "Windows, macOS, Linux",
    "打包工具": "electron-builder"
  },
  "前端框架": {
    "React": "19.1.0",
    "TypeScript": "5.8.3", 
    "Vite": "7.0.4"
  },
  "状态管理": {
    "Zustand": "5.0.7",
    "命令模式": "自实现"
  },
  "图形交互": {
    "React Flow": "12.8.2",
    "React DND": "16.0.1"
  },
  "富文本编辑": {
    "TipTap": "^2.2.0"
  },
  "AI集成": {
    "OpenAI API": "GPT-4/GPT-4 Turbo",
    "Anthropic Claude": "Claude-3.5 Sonnet", 
    "本地存储": "加密API密钥管理"
  },
  "样式方案": {
    "原生CSS": "模块化CSS + CSS变量",
    "CSS架构": "BEM方法论 + 组件作用域样式"
  }
}
```

## 分层数据流架构

### 多层分离设计
```
视图层（表现）→ 知识层（语义）
       ↓            ↓
    Style        Node/Edge
   布局样式       语义关系
      ↓            ↓
  多视图呈现     AI理解操作
```

### 工作台视图映射规则

| 视图类型 | 知识层映射 | 视图层属性 | 使用场景 |
|---------|-----------|-----------|----------|
| 白板视图 | Node/Edge | position, size | 空间关系展示 |
| 富文本视图 | Node/Block | formatting, style | 详细内容编辑 |
| 列表视图 | Node/Relation | order, filter | 结构化管理 |
| 媒体视图 | MediaNode | display, zoom | 多媒体内容 |

### 灵活工作台数据流向
```
用户操作 → 工作台管理 → AI协作 → 状态更新 → 视图渲染
    ↓         ↓         ↓         ↓         ↓
  多白板交互  视图切换   智能建议   状态同步   即时反馈
    ↓         ↓         ↓         ↓         ↓
  侧边栏管理  富文本编辑 关系优化   实时协作   用户确认
```

## 灵活工作台架构

```
App (应用根组件)
├── WorkspaceLayout (工作台布局)
│   ├── Sidebar (侧边栏)
│   │   ├── ViewManager (视图管理器)
│   │   │   ├── WhiteboardListView (白板列表)
│   │   │   ├── NodeListView (节点列表)
│   │   │   ├── EdgeListView (边列表)
│   │   │   ├── RelationListView (关系列表)
│   │   │   ├── RichTextEditorView (富文本编辑器)
│   │   │   ├── TableView (表格视图)
│   │   │   ├── TimelineView (时间线视图)
│   │   │   └── MediaView (媒体视图)
│   │   └── ViewRenderer (视图渲染器)
│   └── WorkspaceArea (工作区域)
│       ├── WhiteboardManager (白板管理器)
│       │   └── WhiteboardInstance (白板实例)
│       │       ├── UnifiedNode (统一节点)
│       │       │   ├── DotNode (点模式)
│       │       │   ├── BoxNode (框模式)  
│       │       │   └── CardNode (卡片模式)
│       │       │       └── DraggableBlock (内容块)
│       │       │           └── TipTapEditor (富文本)
│       │       ├── GraphEdge (图边)
│       │       └── FloatingToolbar (工具栏)
│       └── ViewPort (视图端口)
│           └── ActiveView (当前激活视图)
```

## 开发指南

### 🚀 快速开始
1. 参考 [CLAUDE.md](../CLAUDE.md) 了解项目架构
2. 阅读 [项目愿景](01_Overview/project_vision.md) 理解产品目标
3. 查看 [系统架构](02_Architecture/system_architecture.md) 掌握技术方案

### 📚 深入学习
1. **数据模型**: 从 [实体定义](03_DataModel/entity_definitions.md) 开始理解数据结构
2. **标签系统**: 学习 [标签系统设计](03_DataModel/label_system_design.md) 掌握语义化标签体系
3. **组件开发**: 参考 [组件层次](04_Components/component_hierarchy.md) 了解组件职责
4. **交互设计**: 学习 [交互设计](05_UserInteraction/interaction_design.md) 优化用户体验
5. **技术实现**: 查阅 [实现细节](06_TechnicalSpecs/implementation_details.md) 解决技术问题

### 🔧 开发规范
- **类型安全**: 严格使用 TypeScript 类型定义
- **组件设计**: 遵循单一职责原则，优先组合而非继承
- **状态管理**: 所有数据修改必须通过命令系统
- **性能优化**: 使用 React.memo、useMemo、选择器模式
- **代码质量**: 遵循 ESLint 规则，保持代码一致性

### 🧪 测试策略
- **单元测试**: 核心工具函数和数据转换逻辑
- **组件测试**: 关键组件的交互和状态管理
- **集成测试**: 命令系统和状态管理的端到端测试
- **E2E测试**: 核心用户流程的自动化测试

## 版本历史

### v0.1.0 (当前)
- ✅ 基础架构搭建
- ✅ 核心数据模型定义
- ✅ 三种节点显示模式
- ✅ TipTap 富文本集成
- ✅ 命令系统和撤销/重做
- ✅ 中心点坐标系统
- ✅ React Flow 图形交互
- ✅ 基础插件系统架构

### 📋 后续规划
- **v0.2.0**: AI协作核心功能（关系建议、内容生成）
- **v0.3.0**: 插件市场和AI功能插件
- **v0.4.0**: 多视图格式支持和专业领域插件
- **v0.5.0**: 协作功能和实时AI协同
- **v1.0.0**: 完整AI增强的知识图谱系统

## 贡献指南

### 📖 阅读顺序
新团队成员建议按以下顺序阅读文档：
1. README.md (本文档) - 获得全局概览
2. 项目愿景 - 理解产品定位
3. 系统架构 - 掌握技术架构  
4. 实体定义 - 理解数据模型
5. 标签系统设计 - 掌握语义化标签体系
6. 组件层次 - 了解代码结构
7. 交互设计 - 学习用户体验
8. 实现细节 - 解决技术问题

### 🔄 文档更新
- 重大架构变更时必须更新相关设计文档
- 新功能开发前先更新设计文档征求反馈
- 定期review文档内容确保与代码实现一致

### 💬 问题讨论
遇到设计相关问题时，请参考相应文档章节，如仍有疑问可通过以下方式讨论：
- 技术架构问题 → 系统架构文档
- 数据结构问题 → 实体定义文档
- 标签系统问题 → 标签系统设计文档
- 组件设计问题 → 组件层次文档
- 用户体验问题 → 交互设计文档

---

📍 **文档最后更新**: 2024年8月  
👥 **维护团队**: Graph-cc 开发团队  
📧 **联系方式**: 项目issue或团队内部讨论